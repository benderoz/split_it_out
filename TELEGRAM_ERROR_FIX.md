# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "The string did not match the expected pattern"

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ Mini App –≤ Telegram –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞:
```
–ø—Ä–æ–±–ª–µ–º–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º: The string did not match the expected pattern
```

## –ü—Ä–∏—á–∏–Ω–∞
–û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –æ—Ç–≤–µ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º JSON. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –∫–æ–≥–¥–∞:

1. –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –æ—à–∏–±–∫–æ–π –≤–º–µ—Å—Ç–æ JSON
2. –°–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏ –±—Ä–∞—É–∑–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤–æ—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—à–∏–±–∫–∏
3. API endpoint –Ω–µ –Ω–∞–π–¥–µ–Ω (404) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è HTML
4. –§—É–Ω–∫—Ü–∏—è `testAPIConnection()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ Telegram, –≥–¥–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ—Å—Ç—É–ø –∫ API

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ JSON –ø–∞—Ä—Å–∏–Ω–≥–∞
**–ë—ã–ª–æ:**
```javascript
const result = await response.json(); // –ü–∞–¥–∞–µ—Ç –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ JSON
```

**–°—Ç–∞–ª–æ:**
```javascript
let result;
try {
    result = await response.json();
} catch (jsonError) {
    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', jsonError);
    throw new Error(`–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON: ${jsonError.message}`);
}
```

### 2. –û—Ç–∫–ª—é—á–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç API –≤ Telegram
**–ë—ã–ª–æ:**
```javascript
function initializeApp() {
    // ...
    testAPIConnection(); // –í—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å
}
```

**–°—Ç–∞–ª–æ:**
```javascript
function initializeApp() {
    // ...
    if (!window.Telegram?.WebApp?.initData) {
        testAPIConnection(); // –¢–æ–ª—å–∫–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
    }
}
```

### 3. –£–ª—É—á—à–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
**–ë—ã–ª–æ:**
```javascript
const tg = window.Telegram.WebApp;
tg.expand(); // –ú–æ–≥–ª–æ –ø–∞–¥–∞—Ç—å
tg.ready();
```

**–°—Ç–∞–ª–æ:**
```javascript
let tg = null;
try {
    if (window.Telegram && window.Telegram.WebApp) {
        tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();
    }
} catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram WebApp:', error);
    tg = null;
}
```

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ Telegram –º–µ—Ç–æ–¥–æ–≤
**–ë—ã–ª–æ:**
```javascript
function showError(message) {
    if (tg.showAlert) {
        tg.showAlert(message);
    }
}
```

**–°—Ç–∞–ª–æ:**
```javascript
function showError(message) {
    try {
        if (tg && tg.showAlert && typeof tg.showAlert === 'function') {
            tg.showAlert(message);
        } else {
            alert(message);
        }
    } catch (error) {
        alert(message);
    }
}
```

---

## üß™ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
–û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:3000/debug-telegram.html

–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫–∞–∂–µ—Ç:
- ‚úÖ –°—Ç–∞—Ç—É—Å Telegram WebApp
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- üìã –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
1. –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:3000
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Console**
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
5. –ù–∞–π–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

### 3. –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–µ—Ä —Å–º–æ—Ç—Ä–∏—Ç–µ:
```
[timestamp] POST /api/upload-receipt - IP
Headers: {...}
```

---

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –í –±—Ä–∞—É–∑–µ—Ä–µ:
```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
node server.js

# 2. –û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
http://localhost:3000/debug-telegram.html

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
http://localhost:3000
```

### –í Telegram:
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Mini App –≤ @BotFather:
   ```
   /newapp
   # –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
   # URL: https://yourdomain.com
   ```

2. –û—Ç–∫—Ä–æ–π—Ç–µ Mini App –≤ Telegram
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª

---

## üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ
curl http://localhost:3000/api/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
curl https://yourdomain.com/api/health
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS
Telegram Mini Apps —Ç—Ä–µ–±—É—é—Ç HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:
```nginx
server {
    listen 443 ssl;
    server_name yourdomain.com;
    
    ssl_certificate /path/to/certificate.crt;
    ssl_certificate_key /path/to/private.key;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–û–±–Ω–æ–≤–∏—Ç–µ `.env` –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
```env
NODE_ENV=production
WEBHOOK_URL=https://yourdomain.com
PORT=3000
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ `/debug-telegram.html` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "API —Ä–∞–±–æ—Ç–∞–µ—Ç"
- ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `/` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ –í –∫–æ–Ω—Å–æ–ª–∏ –Ω–µ—Ç –æ—à–∏–±–æ–∫ "string did not match pattern"
- ‚úÖ Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ JSON –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ –ø–∞–¥–∞–µ—Ç

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–û—à–∏–±–∫–∞ "The string did not match the expected pattern" –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞!**

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π JSON –ø–∞—Ä—Å–∏–Ω–≥
2. ‚úÖ –£—Å–ª–æ–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ API —Ç–µ—Å—Ç–æ–≤
3. ‚úÖ –ù–∞–¥–µ–∂–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
4. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—à–∏–±–æ–∫
5. ‚úÖ –û—Ç–ª–∞–¥–æ—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏:
1. üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ HTTPS —Å–µ—Ä–≤–µ—Ä–µ
2. üîó –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –≤ Telegram
3. üì± –ü—É–±–ª–∏–∫–∞—Ü–∏—è Mini App —á–µ—Ä–µ–∑ @BotFather

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ –≤ Telegram!** üéâ